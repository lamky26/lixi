<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN PANEL - Qu·∫£n L√Ω Game</title>
    <style>
        body { font-family: 'Consolas', monospace; background-color: #111; color: #e0e0e0; padding: 20px; }
        
        /* Layout Header */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #444; padding-bottom: 10px; margin-bottom: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Inputs & Buttons */
        input, button { padding: 8px 12px; margin: 5px 0; background: #222; border: 1px solid #555; color: white; font-family: inherit; }
        button { cursor: pointer; font-weight: bold; transition: 0.2s; border-radius: 4px; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        /* M√†u n√∫t b·∫•m */
        .btn-save { background: #28a745; border-color: #28a745; font-size: 16px; padding: 10px 20px; }
        /* N√∫t Copy m·ªõi */
        .btn-copy { background: #6c757d; border-color: #6c757d; font-size: 16px; padding: 10px 20px; margin-right: 10px; }
        
        .btn-load { background: #007bff; border-color: #007bff; }
        .btn-add { background: #17a2b8; border-color: #17a2b8; }
        .btn-edit { background: #ffc107; color: black; border-color: #ffc107; }
        .btn-del { background: #dc3545; border-color: #dc3545; }

        /* B·∫£ng d·ªØ li·ªáu */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1e1e1e; }
        th, td { border: 1px solid #333; padding: 12px; text-align: left; }
        th { background: #333; color: #fff; }
        tr:hover { background: #2a2a2a; }

        .status-bar { padding: 10px; background: #333; margin-bottom: 10px; color: yellow; text-align: center; border-radius: 4px; }
        .add-user-box { background: #222; padding: 15px; border: 1px dashed #555; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ADMIN CONTROL PANEL</h1>
        <div>
            <button class="btn-copy" onclick="copyToClipboard()">üìã COPY DATA</button>
            <button class="btn-save" onclick="saveToCloud()">üíæ L∆ØU THAY ƒê·ªîI</button>
        </div>
    </div>

    <div id="status" class="status-bar">ƒêang ch·ªù k·∫øt n·ªëi...</div>

    <div class="add-user-box">
        <h3>+ Th√™m User:</h3>
        <input type="text" id="newUsername" placeholder="Username">
        <input type="text" id="newPassword" placeholder="Password">
        <input type="number" id="newMoney" placeholder="Ti·ªÅn (VND)">
        <button class="btn-add" onclick="addUser()">T·∫°o M·ªõi</button>
    </div>

    <div style="margin-bottom: 10px;">
        <button class="btn-load" onclick="loadFromCloud()">üîÑ T·∫£i l·∫°i d·ªØ li·ªáu m·ªõi nh·∫•t</button>
        <span>(T·ªïng: <b id="totalUsers">0</b> ng∆∞·ªùi ch∆°i)</span>
    </div>

    <table>
        <thead>
            <tr>
                <th>STT</th>
                <th>T√™n ƒëƒÉng nh·∫≠p</th>
                <th>M·∫≠t kh·∫©u</th>
                <th>T√†i s·∫£n (VND)</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody id="userTableBody"></tbody>
    </table>
</div>

<script>
    // --- C·∫§U H√åNH ---
    const BIN_ID = "697120c943b1c97be93fe9ef"; 
    const API_KEY = "$2a$10$ydhdH89Dl8iCYTFsadTlguL.T4QxNH.79JsL62PntdptM1TmcDPKi"; 
    // ----------------

    let users = [];

    // --- CH·ª®C NƒÇNG M·ªöI: COPY TO CLIPBOARD ---
    async function copyToClipboard() {
        if (users.length === 0) {
            alert("Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ copy!");
            return;
        }
        
        // Chuy·ªÉn d·ªØ li·ªáu th√†nh chu·ªói vƒÉn b·∫£n ƒë·∫πp m·∫Øt
        const dataStr = JSON.stringify(users, null, 2);
        
        try {
            // L·ªánh copy hi·ªán ƒë·∫°i
            await navigator.clipboard.writeText(dataStr);
            updateStatus("ƒê√£ copy to√†n b·ªô d·ªØ li·ªáu v√†o b·ªô nh·ªõ t·∫°m!");
            alert("ƒê√£ COPY th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ d√°n (Ctrl+V) v√†o Notepad ƒë·ªÉ l∆∞u d·ª± ph√≤ng.");
        } catch (err) {
            console.error('L·ªói copy:', err);
            updateStatus("L·ªói kh√¥ng th·ªÉ copy t·ª± ƒë·ªông.");
        }
    }
    // ----------------------------------------

    async function loadFromCloud() {
        updateStatus("ƒêang t·∫£i d·ªØ li·ªáu t·ª´ server...");
        try {
            let req = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                headers: { "X-Master-Key": API_KEY }
            });
            let json = await req.json();
            users = json.record;
            renderTable();
            updateStatus("ƒê√£ t·∫£i xong d·ªØ li·ªáu! S·∫µn s√†ng ch·ªânh s·ª≠a.");
        } catch (err) {
            updateStatus("L·ªói k·∫øt n·ªëi! Ki·ªÉm tra l·∫°i ID/Key.");
        }
    }

    async function saveToCloud() {
        if(!confirm("L∆∞u d·ªØ li·ªáu l√™n m√¢y?")) return;
        updateStatus("ƒêang ƒë·∫©y d·ªØ li·ªáu l√™n m√¢y...");
        try {
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json", "X-Master-Key": API_KEY },
                body: JSON.stringify(users)
            });
            updateStatus("L∆ØU TH√ÄNH C√îNG!");
            alert("ƒê√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu th√†nh c√¥ng!");
        } catch (err) {
            updateStatus("L·ªói khi l∆∞u!");
        }
    }

    function renderTable() {
        const tbody = document.getElementById("userTableBody");
        tbody.innerHTML = "";
        document.getElementById("totalUsers").innerText = users.length;

        users.forEach((user, index) => {
            tbody.innerHTML += `
                <tr>
                    <td>${index + 1}</td>
                    <td style="color: #00ff00; font-weight:bold">${user.username}</td>
                    <td>${user.password}</td>
                    <td style="color: gold">${parseInt(user.money).toLocaleString()}</td>
                    <td>
                        <button class="btn-edit" onclick="editName(${index})">S·ª≠a T√™n</button>
                        <button class="btn-edit" onclick="editMoney(${index})">S·ª≠a Ti·ªÅn</button>
                        <button class="btn-del" onclick="deleteUser(${index})">X√≥a</button>
                    </td>
                </tr>`;
        });
    }

    function addUser() {
        const u = document.getElementById("newUsername").value;
        const p = document.getElementById("newPassword").value;
        const m = document.getElementById("newMoney").value;
        if(u && p) {
            if(users.some(user => user.username === u)) { alert("T√™n t·ªìn t·∫°i!"); return; }
            users.push({ username: u, password: p, money: parseInt(m) || 0 });
            document.getElementById("newUsername").value = "";
            document.getElementById("newPassword").value = "";
            document.getElementById("newMoney").value = "";
            renderTable();
            updateStatus("ƒê√£ th√™m user m·ªõi (Ch∆∞a l∆∞u l√™n server).");
        } else { alert("Thi·∫øu th√¥ng tin!"); }
    }

    function deleteUser(index) {
        if(confirm(`X√≥a user: ${users[index].username}?`)) {
            users.splice(index, 1);
            renderTable();
        }
    }

    function editName(index) {
        const newName = prompt("T√™n m·ªõi:", users[index].username);
        if(newName && newName !== users[index].username) {
            users[index].username = newName;
            renderTable();
        }
    }

    function editMoney(index) {
        const newMoney = prompt(`Ti·ªÅn m·ªõi cho ${users[index].username}:`, users[index].money);
        if(newMoney !== null) {
            users[index].money = parseInt(newMoney);
            renderTable();
        }
    }

    function updateStatus(msg) {
        document.getElementById("status").innerText = msg;
    }

    loadFromCloud();
</script>

</body>
</html>