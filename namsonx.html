<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN PANEL - Qu·∫£n L√Ω Game</title>
    <style>
        body { font-family: 'Consolas', monospace; background-color: #111; color: #e0e0e0; padding: 20px; }
        
        /* Layout */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #444; padding-bottom: 10px; margin-bottom: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* Inputs & Buttons */
        input, button { padding: 8px 12px; margin: 5px 0; background: #222; border: 1px solid #555; color: white; font-family: inherit; }
        button { cursor: pointer; font-weight: bold; transition: 0.2s; }
        
        /* M√†u n√∫t b·∫•m theo ch·ª©c nƒÉng */
        .btn-load { background: #007bff; border-color: #007bff; }
        .btn-save { background: #28a745; border-color: #28a745; font-size: 16px; padding: 10px 20px; }
        .btn-add { background: #17a2b8; border-color: #17a2b8; }
        .btn-edit { background: #ffc107; color: black; border-color: #ffc107; }
        .btn-del { background: #dc3545; border-color: #dc3545; }
        
        button:hover { opacity: 0.8; }

        /* B·∫£ng d·ªØ li·ªáu */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1e1e1e; }
        th, td { border: 1px solid #333; padding: 12px; text-align: left; }
        th { background: #333; color: #fff; }
        tr:hover { background: #2a2a2a; }

        /* Ti·ªán √≠ch */
        .status-bar { padding: 10px; background: #333; margin-bottom: 10px; color: yellow; text-align: center; }
        .add-user-box { background: #222; padding: 15px; border: 1px dashed #555; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ADMIN CONTROL PANEL</h1>
        <button class="btn-save" onclick="saveToCloud()">üíæ L∆ØU THAY ƒê·ªîI L√äN M√ÇY</button>
    </div>

    <div id="status" class="status-bar">ƒêang ch·ªù k·∫øt n·ªëi...</div>

    <div class="add-user-box">
        <h3>+ Th√™m User:</h3>
        <input type="text" id="newUsername" placeholder="Username">
        <input type="text" id="newPassword" placeholder="Password">
        <input type="number" id="newMoney" placeholder="Ti·ªÅn (VND)">
        <button class="btn-add" onclick="addUser()">T·∫°o M·ªõi</button>
    </div>

    <div style="margin-bottom: 10px;">
        <button class="btn-load" onclick="loadFromCloud()">üîÑ T·∫£i l·∫°i d·ªØ li·ªáu m·ªõi nh·∫•t</button>
        <span>(T·ªïng: <b id="totalUsers">0</b> ng∆∞·ªùi ch∆°i)</span>
    </div>

    <table>
        <thead>
            <tr>
                <th>STT</th>
                <th>T√™n ƒëƒÉng nh·∫≠p</th>
                <th>M·∫≠t kh·∫©u</th>
                <th>T√†i s·∫£n (VND)</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody id="userTableBody">
            </tbody>
    </table>
</div>

<script>
    // --- C·∫§U H√åNH (D√ôNG CHUNG V·ªöI FILE GAME) ---
    const BIN_ID = "697120c943b1c97be93fe9ef"; 
    const API_KEY = "$2a$10$ydhdH89Dl8iCYTFsadTlguL.T4QxNH.79JsL62PntdptM1TmcDPKi"; 
    // -------------------------------------------

    let users = [];

    // 1. T·∫¢I D·ªÆ LI·ªÜU T·ª™ JSONBIN
    async function loadFromCloud() {
        updateStatus("ƒêang t·∫£i d·ªØ li·ªáu t·ª´ server...");
        try {
            let req = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                headers: { "X-Master-Key": API_KEY }
            });
            let json = await req.json();
            users = json.record;
            renderTable();
            updateStatus("ƒê√£ t·∫£i xong d·ªØ li·ªáu! S·∫µn s√†ng ch·ªânh s·ª≠a.");
        } catch (err) {
            updateStatus("L·ªói k·∫øt n·ªëi! Ki·ªÉm tra l·∫°i BIN ID v√† API Key.");
            console.error(err);
        }
    }

    // 2. L∆ØU D·ªÆ LI·ªÜU L√äN JSONBIN
    async function saveToCloud() {
        if(!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën l∆∞u c√°c thay ƒë·ªïi n√†y l√™n server kh√¥ng?")) return;

        updateStatus("ƒêang ƒë·∫©y d·ªØ li·ªáu l√™n m√¢y...");
        try {
            await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "X-Master-Key": API_KEY
                },
                body: JSON.stringify(users)
            });
            updateStatus("L∆ØU TH√ÄNH C√îNG! Ng∆∞·ªùi ch∆°i c√≥ th·ªÉ th·∫•y thay ƒë·ªïi ngay.");
            alert("ƒê√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu th√†nh c√¥ng!");
        } catch (err) {
            updateStatus("L·ªói khi l∆∞u! Vui l√≤ng th·ª≠ l·∫°i.");
        }
    }

    // 3. HI·ªÇN TH·ªä B·∫¢NG
    function renderTable() {
        const tbody = document.getElementById("userTableBody");
        tbody.innerHTML = "";
        document.getElementById("totalUsers").innerText = users.length;

        users.forEach((user, index) => {
            const row = `
                <tr>
                    <td>${index + 1}</td>
                    <td style="color: #00ff00; font-weight:bold">${user.username}</td>
                    <td>${user.password}</td>
                    <td style="color: gold">${parseInt(user.money).toLocaleString()}</td>
                    <td>
                        <button class="btn-edit" onclick="editName(${index})">S·ª≠a T√™n</button>
                        <button class="btn-edit" onclick="editPassword(${index})">S·ª≠a MK</button>
                        <button class="btn-edit" onclick="editMoney(${index})">S·ª≠a Ti·ªÅn</button>
                        <button class="btn-del" onclick="deleteUser(${index})">X√≥a</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // 4. C√ÅC CH·ª®C NƒÇNG S·ª¨A ƒê·ªîI (LOGIC)
    
    // Th√™m ng∆∞·ªùi d√πng m·ªõi
    function addUser() {
        const u = document.getElementById("newUsername").value;
        const p = document.getElementById("newPassword").value;
        const m = document.getElementById("newMoney").value;

        if(u && p) {
            // Ki·ªÉm tra tr√πng t√™n
            if(users.some(user => user.username === u)) {
                alert("T√™n ƒëƒÉng nh·∫≠p n√†y ƒë√£ t·ªìn t·∫°i!");
                return;
            }

            users.push({
                username: u,
                password: p,
                money: parseInt(m) || 0
            });
            
            // X√≥a tr·∫Øng √¥ nh·∫≠p
            document.getElementById("newUsername").value = "";
            document.getElementById("newPassword").value = "";
            document.getElementById("newMoney").value = "";
            
            renderTable();
            updateStatus("ƒê√£ th√™m user m·ªõi (Ch∆∞a l∆∞u l√™n server).");
        } else {
            alert("Vui l√≤ng nh·∫≠p Username v√† Password!");
        }
    }

    // X√≥a ng∆∞·ªùi d√πng
    function deleteUser(index) {
        if(confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a user: ${users[index].username}?`)) {
            users.splice(index, 1);
            renderTable();
            updateStatus("ƒê√£ x√≥a user (Ch∆∞a l∆∞u l√™n server).");
        }
    }

    // S·ª≠a T√™n
    function editName(index) {
        const newName = prompt("Nh·∫≠p t√™n m·ªõi:", users[index].username);
        if(newName && newName !== users[index].username) {
            users[index].username = newName;
            renderTable();
        }
    }

    // S·ª≠a Ti·ªÅn
    function editMoney(index) {
        const newMoney = prompt(`Nh·∫≠p s·ªë ti·ªÅn m·ªõi cho ${users[index].username}:`, users[index].money);
        if(newMoney !== null) {
            users[index].money = parseInt(newMoney);
            renderTable();
        }
    }

    // S·ª≠a M·∫≠t kh·∫©u
    function editPassword(index) {
        const newPassword = prompt(`Nh·∫≠p m·∫≠t kh·∫©u m·ªõi cho ${users[index].username}:`, users[index].password);
        if(newPassword && newPassword !== users[index].password) {
            users[index].password = newPassword;
            renderTable();
            updateStatus("ƒê√£ s·ª≠a m·∫≠t kh·∫©u (Ch∆∞a l∆∞u l√™n server).");
        }
    }

    function updateStatus(msg) {
        document.getElementById("status").innerText = msg;
    }

    // T·ª± ƒë·ªông load khi m·ªü trang
    loadFromCloud();

</script>

</body>
</html>